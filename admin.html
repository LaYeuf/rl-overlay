<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel - RL Overlay</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333}
.login-page{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
.login-container{background:rgba(255,255,255,.95);backdrop-filter:blur(20px);border-radius:20px;padding:50px 40px;width:100%;max-width:450px;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.login-page.hidden{display:none}
.admin-page{display:none;padding:20px;max-width:1400px;margin:0 auto}
.admin-page.active{display:block}
h1{text-align:center;margin-bottom:10px;font-size:32px;font-weight:900;color:#667eea}
.subtitle{text-align:center;margin-bottom:30px;opacity:.7;font-size:14px}
.input-group{margin-bottom:20px}
.input-group label{display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:#555}
.input-group input,.input-group select,.input-group textarea{width:100%;padding:14px 16px;border:2px solid #e9ecef;border-radius:10px;font-size:15px;transition:all .3s;background:#f8f9fa}
.input-group input:focus,.input-group select:focus,.input-group textarea:focus{outline:none;border-color:#667eea;background:#fff}
.btn{padding:16px;border:none;border-radius:10px;font-weight:700;font-size:16px;cursor:pointer;transition:all .3s;text-transform:uppercase;letter-spacing:1px}
.btn-primary{width:100%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;box-shadow:0 10px 30px rgba(102,126,234,.4)}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 15px 40px rgba(102,126,234,.6)}
.btn-secondary{background:#6c757d;color:#fff}
.btn-secondary:hover{background:#5a6268}
.btn-danger{background:#dc3545;color:#fff}
.btn-danger:hover{background:#c82333}
.btn-success{background:#28a745;color:#fff}
.btn-success:hover{background:#218838}
.error,.success{padding:12px;border-radius:8px;margin-bottom:20px;text-align:center;font-weight:600;display:none}
.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
.error.show,.success.show{display:block}
.header{background:#fff;border-radius:12px;padding:20px;margin-bottom:25px;box-shadow:0 2px 10px rgba(0,0,0,.1);display:flex;justify-content:space-between;align-items:center}
.header h1{margin:0;text-align:left;font-size:28px}
.section{background:#fff;border-radius:12px;padding:25px;margin-bottom:25px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
.section h2{color:#667eea;margin-bottom:20px;font-size:22px;border-bottom:3px solid #667eea;padding-bottom:10px}
.events-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px;margin-top:20px}
.event-card{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:20px;border-radius:12px;cursor:pointer;transition:all .3s;box-shadow:0 5px 15px rgba(0,0,0,.2)}
.event-card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.3)}
.event-card h3{margin-bottom:10px;font-size:20px}
.event-card p{opacity:.9;font-size:14px;margin-bottom:8px}
.event-card .url{background:rgba(255,255,255,.2);padding:8px;border-radius:6px;font-size:12px;font-family:monospace;word-break:break-all;margin-top:10px}
.event-card .actions{display:flex;gap:10px;margin-top:15px}
.event-card .actions button{flex:1;padding:10px;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:all .2s}
.event-card .actions .btn-edit{background:rgba(255,255,255,.9);color:#667eea}
.event-card .actions .btn-edit:hover{background:#fff}
.event-card .actions .btn-delete{background:rgba(220,53,69,.9);color:#fff}
.event-card .actions .btn-delete:hover{background:#dc3545}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:1000;align-items:center;justify-content:center;padding:20px}
.modal.active{display:flex}
.modal-content{background:#fff;border-radius:16px;padding:30px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto}
.modal-content h2{color:#667eea;margin-bottom:25px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:15px}
.close-modal{float:right;font-size:28px;font-weight:700;color:#999;cursor:pointer}
.close-modal:hover{color:#333}
.copy-btn{background:#17a2b8;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:600;margin-top:10px}
.copy-btn:hover{background:#138496}
</style>
</head>
<body>
<div class="login-page" id="loginPage">
<div class="login-container">
<h1>üéÆ Admin Panel</h1>
<p class="subtitle">Rocket League Overlay Manager</p>
<div id="loginError" class="error"></div>
<div class="input-group">
<label>Email</label>
<input type="email" id="loginEmail" placeholder="admin@example.com">
</div>
<div class="input-group">
<label>Mot de passe</label>
<input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
</div>
<button class="btn btn-primary" id="loginBtn">Se connecter</button>
</div>
</div>

<div class="admin-page" id="adminPage">
<div class="header">
<h1>üéÆ Gestion des Overlays</h1>
<button class="btn btn-danger" id="logoutBtn">D√©connexion</button>
</div>
<div id="adminError" class="error"></div>
<div id="adminSuccess" class="success"></div>
<div class="section">
<h2>üìä Mes √âv√©nements</h2>
<button class="btn btn-success" id="newEventBtn">+ Cr√©er un nouvel √©v√©nement</button>
<div class="events-grid" id="eventsGrid"></div>
</div>
</div>

<div class="modal" id="eventModal">
<div class="modal-content">
<span class="close-modal" id="closeModal">&times;</span>
<h2 id="modalTitle">Nouvel √âv√©nement</h2>
<div class="input-group">
<label>Nom de l'√©v√©nement</label>
<input type="text" id="modalEventName" placeholder="RLCS EU - Semi-Final">
</div>
<div class="form-row">
<div class="input-group">
<label>√âquipe Bleue</label>
<input type="text" id="modalBlueTeam" placeholder="TEAM BLUE">
</div>
<div class="input-group">
<label>√âquipe Orange</label>
<input type="text" id="modalOrangeTeam" placeholder="TEAM ORANGE">
</div>
</div>
<div class="form-row">
<div class="input-group">
<label>Couleur Bleue</label>
<input type="color" id="modalBlueColor" value="#5DADE2">
</div>
<div class="input-group">
<label>Couleur Orange</label>
<input type="color" id="modalOrangeColor" value="#F39C12">
</div>
</div>
<div class="form-row">
<div class="input-group">
<label>Best Of</label>
<input type="number" id="modalBestOf" min="1" max="9" step="2" value="5">
</div>
<div class="input-group">
<label>WebSocket URL (SOS)</label>
<input type="text" id="modalWsUrl" placeholder="ws://192.168.1.100:49122">
</div>
</div>
<div class="form-row">
<div class="input-group">
<label>Wins Bleu</label>
<input type="number" id="modalBlueWins" min="0" value="0">
</div>
<div class="input-group">
<label>Wins Orange</label>
<input type="number" id="modalOrangeWins" min="0" value="0">
</div>
</div>
<button class="btn btn-primary" id="saveEventBtn">üíæ Sauvegarder</button>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL='https://vxwahcquiueympgpciqo.supabase.co';
const SUPABASE_ANON_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ4d2FoY3F1aXVleW1wZ3BjaXFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwMTQ0MTIsImV4cCI6MjA4NDU5MDQxMn0.ussT6yt_Qcc6Ft0a4wHNR_VFnHspg7EpLiD3SmkWv80';
const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

let currentUser=null,editingEventId=null;
const el={
  loginPage:document.getElementById('loginPage'),
  adminPage:document.getElementById('adminPage'),
  loginEmail:document.getElementById('loginEmail'),
  loginPassword:document.getElementById('loginPassword'),
  loginBtn:document.getElementById('loginBtn'),
  logoutBtn:document.getElementById('logoutBtn'),
  loginError:document.getElementById('loginError'),
  adminError:document.getElementById('adminError'),
  adminSuccess:document.getElementById('adminSuccess'),
  newEventBtn:document.getElementById('newEventBtn'),
  eventsGrid:document.getElementById('eventsGrid'),
  eventModal:document.getElementById('eventModal'),
  closeModal:document.getElementById('closeModal'),
  saveEventBtn:document.getElementById('saveEventBtn'),
  modalTitle:document.getElementById('modalTitle')
};

async function init(){
  const{data:{session}}=await supabase.auth.getSession();
  if(session){
    currentUser=session.user;
    showAdminPage();
  }
}

el.loginBtn.addEventListener('click',async()=>{
  const email=el.loginEmail.value.trim();
  const password=el.loginPassword.value;
  
  if(!email||!password){
    showError(el.loginError,'Veuillez remplir tous les champs');
    return;
  }
  
  try{
    const{data,error}=await supabase.auth.signInWithPassword({email,password});
    if(error)throw error;
    currentUser=data.user;
    showAdminPage();
  }catch(e){
    showError(el.loginError,'Email ou mot de passe incorrect');
  }
});

el.logoutBtn.addEventListener('click',async()=>{
  await supabase.auth.signOut();
  currentUser=null;
  el.adminPage.classList.remove('active');
  el.loginPage.classList.remove('hidden');
});

el.newEventBtn.addEventListener('click',()=>{
  editingEventId=null;
  el.modalTitle.textContent='Nouvel √âv√©nement';
  clearModalForm();
  el.eventModal.classList.add('active');
});

el.closeModal.addEventListener('click',()=>el.eventModal.classList.remove('active'));

el.saveEventBtn.addEventListener('click',async()=>{
  const eventName=document.getElementById('modalEventName').value.trim();
  const blueTeam=document.getElementById('modalBlueTeam').value.trim();
  const orangeTeam=document.getElementById('modalOrangeTeam').value.trim();
  const blueColor=document.getElementById('modalBlueColor').value;
  const orangeColor=document.getElementById('modalOrangeColor').value;
  const bestOf=parseInt(document.getElementById('modalBestOf').value);
  const wsUrl=document.getElementById('modalWsUrl').value.trim();
  const blueWins=parseInt(document.getElementById('modalBlueWins').value);
  const orangeWins=parseInt(document.getElementById('modalOrangeWins').value);
  
  if(!eventName||!blueTeam||!orangeTeam){
    showError(el.adminError,'Veuillez remplir les champs obligatoires');
    return;
  }
  
  try{
    if(editingEventId){
      const{error}=await supabase
        .from('event_configs')
        .update({
          event_name:eventName,
          blue_team_name:blueTeam,
          orange_team_name:orangeTeam,
          blue_color:blueColor,
          orange_color:orangeColor,
          best_of:bestOf,
          blue_wins:blueWins,
          orange_wins:orangeWins,
          ws_url:wsUrl,
          updated_at:new Date().toISOString()
        })
        .eq('id',editingEventId);
      
      if(error)throw error;
      showSuccess('‚úÖ √âv√©nement mis √† jour !');
    }else{
      const eventId=generateId();
      const{error}=await supabase
        .from('event_configs')
        .insert({
          event_id:eventId,
          event_name:eventName,
          blue_team_name:blueTeam,
          orange_team_name:orangeTeam,
          blue_color:blueColor,
          orange_color:orangeColor,
          best_of:bestOf,
          blue_wins:blueWins,
          orange_wins:orangeWins,
          ws_url:wsUrl,
          created_by:currentUser.id
        });
      
      if(error)throw error;
      showSuccess('‚úÖ √âv√©nement cr√©√© !');
    }
    
    el.eventModal.classList.remove('active');
    loadEvents();
  }catch(e){
    showError(el.adminError,'Erreur: '+e.message);
  }
});

async function showAdminPage(){
  el.loginPage.classList.add('hidden');
  el.adminPage.classList.add('active');
  loadEvents();
}

async function loadEvents(){
  try{
    const{data,error}=await supabase
      .from('event_configs')
      .select('*')
      .eq('created_by',currentUser.id)
      .order('created_at',{ascending:false});
    
    if(error)throw error;
    renderEvents(data||[]);
  }catch(e){
    showError(el.adminError,'Erreur chargement √©v√©nements: '+e.message);
  }
}

function renderEvents(events){
  el.eventsGrid.innerHTML='';
  if(events.length===0){
    el.eventsGrid.innerHTML='<p style="grid-column:1/-1;text-align:center;padding:40px;color:#999">Aucun √©v√©nement. Cr√©ez-en un !</p>';
    return;
  }
  
  events.forEach(evt=>{
    const card=document.createElement('div');
    card.className='event-card';
    const overlayUrl=`${window.location.origin}/overlay.html?event=${evt.event_id}`;
    card.innerHTML=`
      <h3>${evt.event_name}</h3>
      <p>üîµ ${evt.blue_team_name} vs ${evt.orange_team_name} üü†</p>
      <p>üìä BO${evt.best_of} | Score: ${evt.blue_wins}-${evt.orange_wins}</p>
      <div class="url">${overlayUrl}</div>
      <div class="actions">
        <button class="btn-edit" onclick="editEvent('${evt.id}')">‚úèÔ∏è Modifier</button>
        <button class="btn-delete" onclick="deleteEvent('${evt.id}')">üóëÔ∏è Supprimer</button>
        <button class="copy-btn" onclick="copyUrl('${overlayUrl}')">üìã Copier URL</button>
      </div>
    `;
    el.eventsGrid.appendChild(card);
  });
}

window.editEvent=async(id)=>{
  try{
    const{data,error}=await supabase
      .from('event_configs')
      .select('*')
      .eq('id',id)
      .single();
    
    if(error)throw error;
    editingEventId=id;
    el.modalTitle.textContent='Modifier l\'√©v√©nement';
    document.getElementById('modalEventName').value=data.event_name;
    document.getElementById('modalBlueTeam').value=data.blue_team_name;
    document.getElementById('modalOrangeTeam').value=data.orange_team_name;
    document.getElementById('modalBlueColor').value=data.blue_color;
    document.getElementById('modalOrangeColor').value=data.orange_color;
    document.getElementById('modalBestOf').value=data.best_of;
    document.getElementById('modalWsUrl').value=data.ws_url||'';
    document.getElementById('modalBlueWins').value=data.blue_wins;
    document.getElementById('modalOrangeWins').value=data.orange_wins;
    el.eventModal.classList.add('active');
  }catch(e){
    showError(el.adminError,'Erreur: '+e.message);
  }
};

window.deleteEvent=async(id)=>{
  if(!confirm('√ätes-vous s√ªr de vouloir supprimer cet √©v√©nement ?'))return;
  try{
    const{error}=await supabase
      .from('event_configs')
      .delete()
      .eq('id',id);
    
    if(error)throw error;
    showSuccess('‚úÖ √âv√©nement supprim√© !');
    loadEvents();
  }catch(e){
    showError(el.adminError,'Erreur: '+e.message);
  }
};

window.copyUrl=(url)=>{
  navigator.clipboard.writeText(url);
  showSuccess('üìã URL copi√©e dans le presse-papier !');
};

function clearModalForm(){
  document.getElementById('modalEventName').value='';
  document.getElementById('modalBlueTeam').value='';
  document.getElementById('modalOrangeTeam').value='';
  document.getElementById('modalBlueColor').value='#5DADE2';
  document.getElementById('modalOrangeColor').value='#F39C12';
  document.getElementById('modalBestOf').value='5';
  document.getElementById('modalWsUrl').value='';
  document.getElementById('modalBlueWins').value='0';
  document.getElementById('modalOrangeWins').value='0';
}

function generateId(){
  return'evt_'+Math.random().toString(36).substring(2,11);
}

function showError(el,msg){
  el.textContent=msg;
  el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),5000);
}

function showSuccess(msg){
  el.adminSuccess.textContent=msg;
  el.adminSuccess.classList.add('show');
  setTimeout(()=>el.adminSuccess.classList.remove('show'),3000);
}

init();
</script>
</body>
</html>
